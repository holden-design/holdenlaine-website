---
import translations from '../data/translations.json';
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact - Holden Laine Photography</title>
    <style is:global>
      body {
        margin: 0;
        font-family: "Helvetica Neue", Helvetica;
        background: #fff;
        color: #222;
        display: block;
      }
      #letterfall-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      }
      
      @media (max-width: 768px) {
        .sidebar {
          position: relative !important;
          left: 0 !important;
          top: 0 !important;
          width: 100% !important;
          padding: 1rem !important;
          margin-bottom: 1rem !important;
        }
        .sidebar nav {
          flex-direction: row !important;
          flex-wrap: wrap !important;
          gap: 0.5rem !important;
        }
        .sidebar nav a {
          font-size: 0.9rem !important;
        }
        .container {
          padding: 1rem !important;
        }
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }
      .sidebar {
        position: fixed;
        left: 2rem;
        top: 2rem;
        width: auto;
        z-index: 1000;
        padding: 0;
        margin-bottom: 0;
      }
      .sidebar nav {
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
      }
      .sidebar nav a {
        display: block;
        color: #222;
        text-decoration: none;
        font-weight: 500;
        text-transform: uppercase;
        font-family: inherit;
        letter-spacing: 0.01em;
        font-size: 0.85rem;
      }
      .sidebar nav a:hover { text-decoration: underline; }
      .main-content {
        max-width: 100%;
        margin: 0 auto;
        padding: 0;
      }
      .content-wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        align-items: start;
      }
      .contact-section {
        flex: 1;
      }
      .contact-info {
        margin-top: 2rem;
      }
      .contact-info a {
        color: #222;
        text-decoration: none;
      }
      .contact-info a:hover {
        text-decoration: underline;
      }
      .contact-info p {
        margin: 0.75rem 0;
        font-size: 1rem;
      }
      h1 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }
      h2 {
        font-size: 1.2rem;
        margin: 2rem 0 1rem 0;
        font-weight: 500;
      }
      #calendar {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 0.8rem;
        min-height: auto;
        max-width: 320px;
      }
      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.6rem;
        padding-bottom: 0.6rem;
        border-bottom: 1px solid #e0e0e0;
      }
      .calendar-header h3 {
        margin: 0;
        font-size: 0.85rem;
        font-weight: 500;
      }
      .calendar-nav {
        display: flex;
        gap: 0.3rem;
      }
      .calendar-nav button {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 3px;
        padding: 0.25rem 0.5rem;
        cursor: pointer;
        font-family: "Helvetica Neue", Helvetica;
        font-size: 0.8rem;
        transition: background 0.2s ease;
      }
      .calendar-nav button:hover {
        background: #f5f5f5;
        border-color: #222;
      }
      .calendar-grid {
        display: grid !important;
        grid-template-columns: repeat(7, 1fr) !important;
        gap: 0.2rem;
        margin-top: 0.6rem;
        width: 100%;
      }
      .calendar-day-header {
        text-align: center;
        font-weight: 600;
        font-size: 0.6rem;
        padding: 0.3rem 0;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff;
        border: 1px solid #e8e8e8;
        border-radius: 3px;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.15s ease;
        min-height: 28px;
      }
      .calendar-day:hover:not(.empty):not(.unavailable) {
        background: #f8f8f8;
        border-color: #222;
        transform: scale(1.05);
      }
      .calendar-day.empty {
        background: transparent;
        border: none;
        cursor: default;
      }
      .calendar-day.today {
        background: #222;
        color: #fff;
        font-weight: 600;
        border-color: #222;
      }
      .calendar-day.selected {
        background: #555;
        color: #fff;
        border-color: #555;
        font-weight: 500;
      }
      .calendar-day.unavailable {
        background: #fafafa;
        color: #d0d0d0;
        cursor: not-allowed;
        border-color: #f0f0f0;
      }
      .calendar-day.unavailable:hover {
        background: #fafafa;
        border-color: #f0f0f0;
        transform: none;
      }
      .time-slots {
        margin-top: 0.8rem;
        padding-top: 0.8rem;
        border-top: 1px solid #e0e0e0;
      }
      .time-slots h3 {
        font-size: 0.85rem;
        font-weight: 500;
        margin: 0 0 0.6rem 0;
      }
      .time-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
      }
      .time-slot {
        padding: 0.6rem;
        background: #fff;
        border: 1px solid #e8e8e8;
        border-radius: 4px;
        text-align: center;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.15s ease;
      }
      .time-slot:hover:not(.unavailable) {
        background: #f8f8f8;
        border-color: #222;
      }
      .time-slot.selected {
        background: #222;
        color: #fff;
        border-color: #222;
        font-weight: 500;
      }
      .time-slot.unavailable {
        background: #fafafa;
        color: #d0d0d0;
        cursor: not-allowed;
        border-color: #f0f0f0;
      }
      .time-slot.unavailable:hover {
        background: #fafafa;
        border-color: #f0f0f0;
      }
      @media (max-width: 600px) {
        .time-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      .booking-form {
        margin-top: 0;
        max-width: 100%;
      }
      .form-group {
        margin-bottom: 1.5rem;
      }
      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        font-size: 0.95rem;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: "Helvetica Neue", Helvetica;
        font-size: 1rem;
        box-sizing: border-box;
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #222;
      }
      .form-group input[readonly] {
        background-color: #f8f8f8;
        cursor: pointer;
      }
      .form-group input[readonly]:focus {
        border-color: #ddd;
      }
      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      .submit-btn {
        background: #222;
        color: #fff;
        padding: 0.75rem 2rem;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        font-family: "Helvetica Neue", Helvetica;
        text-transform: uppercase;
        letter-spacing: 0.02em;
      }
      .submit-btn:hover {
        background: #444;
      }
      .submit-btn:disabled {
        background: #999;
        cursor: not-allowed;
      }
      .form-message {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 4px;
        display: none;
      }
      .form-message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        display: block;
      }
      .form-message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        display: block;
      }
      .lang-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 10000;
        display: flex;
        gap: 0.5rem;
      }
      .lang-toggle button {
        background: transparent;
        border: none;
        padding: 0;
        font-size: 0.75rem;
        transition: opacity 0.2s ease;
        opacity: 0.3;
        cursor: pointer;
        font-weight: 500;
        color: #333;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .lang-toggle button:hover {
        opacity: 0.6;
      }
      .lang-toggle button.active {
        opacity: 1;
      }
      @media (max-width: 900px) {
        .content-wrapper {
          grid-template-columns: 1fr;
          gap: 2rem;
        }
      }
      @media (max-width: 600px) {
        .form-row {
          grid-template-columns: 1fr;
        }
      }
      @media (min-width: 600px) {
        .container {
          padding-left: 140px;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="letterfall-canvas"></canvas>
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="en">ENG</button>
      <button class="lang-btn" data-lang="et">EST</button>
    </div>
    <div class="container">
      <div class="sidebar">
        <nav>
          <a href="/">HOME</a>
          <a href="/photos">PHOTOS</a>
          <a href="/portfolio">PROJECTS</a>
          <a href="/prices">PRICES</a>
          <a href="/shop">SHOP</a>
          <a href="/contact">CONTACT</a>
        </nav>
      </div>
      <div class="main-content">
        <h1 data-i18n="contact.heading">Contact</h1>
        
        <div class="content-wrapper">
          <div class="contact-section">
            <div class="contact-info">
              <p><a href="mailto:holdenlaine@outlook.com">holdenlaine@outlook.com</a></p>
              <p><a href="tel:+37255569043">+372 555 69043</a></p>
            </div>

        <h2 data-i18n="contact.bookSession">Book a Session</h2>
        <form class="booking-form" id="bookingForm">
          <input type="hidden" name="access_key" value="dff7794e-dac3-4702-8fb9-bc764d21f727" />
          <input type="hidden" name="subject" value="New Booking Request from Holden Laine Photography" />
          <input type="hidden" name="from_name" value="Holden Laine Photography Contact Form" />
          <input type="hidden" name="replyto" id="replyto" value="" />
          <input type="hidden" name="cc" value="" />
          
          <div class="form-group">
            <label for="name"><span data-i18n="contact.name">Name</span> <span data-i18n="contact.required">*</span></label>
            <input type="text" id="name" name="name" required />
          </div>              <div class="form-group">
                <label for="email"><span data-i18n="contact.email">Email</span> <span data-i18n="contact.required">*</span></label>
                <input type="email" id="email" name="email" required />
              </div>

              <div class="form-group">
                <label for="phone" data-i18n="contact.phone">Phone</label>
                <input type="tel" id="phone" name="phone" />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="date"><span data-i18n="contact.preferredDate">Preferred Date</span> <span data-i18n="contact.required">*</span></label>
                  <input type="text" id="date" name="date" required readonly data-placeholder-i18n="contact.selectFromCalendar" placeholder="Select from calendar" />
                </div>

                <div class="form-group">
                  <label for="time"><span data-i18n="contact.preferredTime">Preferred Time</span> <span data-i18n="contact.required">*</span></label>
                  <input type="text" id="time" name="time" required readonly data-placeholder-i18n="contact.selectDateFirst" placeholder="Select a date first" />
                </div>
              </div>

              <div class="form-group">
                <label for="session-type"><span data-i18n="contact.sessionType">Session Type</span> <span data-i18n="contact.required">*</span></label>
                <select id="session-type" name="session-type" required>
                  <option value="" data-i18n="contact.selectSessionType">Select a session type</option>
                  <option value="portrait" data-i18n="contact.portraitSession">Portrait Session</option>
                  <option value="event" data-i18n="contact.eventPhotography">Event Photography</option>
                  <option value="commercial" data-i18n="contact.commercialProject">Commercial Project</option>
                  <option value="other" data-i18n="contact.other">Other</option>
                </select>
              </div>

              <div class="form-group">
                <label for="message" data-i18n="contact.message">Message</label>
                <textarea id="message" name="message" data-placeholder-i18n="contact.messagePlaceholder" placeholder="Tell me about your project or any specific requirements..."></textarea>
              </div>

              <button type="submit" class="submit-btn" data-i18n="contact.requestBooking">Request Booking</button>
              
              <div class="form-message" id="formMessage"></div>
            </form>
          </div>

          <div class="contact-section">
            <h2 data-i18n="contact.availabilityCalendar">Availability Calendar</h2>
            <div id="calendar"></div>
            <div id="timeSlots" style="display: none;">
              <div class="time-slots">
                <h3 data-i18n="contact.availableTimes">Available Times</h3>
                <div class="time-grid" id="timeGrid"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script define:vars={{ translations }}>
      const t = translations;
      let currentLang = localStorage.getItem('language') || 'en';

      // Get DOM elements first
      const form = document.getElementById('bookingForm');
      const formMessage = document.getElementById('formMessage');
      const calendarEl = document.getElementById('calendar');
      const timeSlotsEl = document.getElementById('timeSlots');
      const timeGridEl = document.getElementById('timeGrid');

      console.log('Calendar element:', calendarEl);

      // Calendar functionality
      let currentDate = new Date();
      let selectedDate = null;
      let selectedTime = null;

      // Available time slots (24-hour format)
      const weekdayEveningSlots = ['18:00', '19:00', '20:00', '21:00'];
      const weekendAllSlots = [
        '09:00', '10:00', '11:00', '12:00',
        '13:00', '14:00', '15:00', '16:00',
        '17:00', '18:00', '19:00', '20:00', '21:00'
      ];

      function renderTimeSlots(date) {
        if (!timeGridEl || !timeSlotsEl) return;

        const today = new Date();
        const isToday = date.toDateString() === today.toDateString();
        const dayOfWeek = date.getDay(); // 0 = Sunday, 6 = Saturday

        // Determine which time slots to show based on day of week
        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6; // Sunday or Saturday
        const timeSlots = isWeekend ? weekendAllSlots : weekdayEveningSlots;

        let html = '';
        
        timeSlots.forEach(time => {
          const [hours, minutes] = time.split(':').map(Number);
          const slotTime = new Date(date);
          slotTime.setHours(hours, minutes, 0, 0);
          
          let classes = 'time-slot';
          
          // Disable past times if it's today
          if (isToday && slotTime < today) {
            classes += ' unavailable';
          }
          
          if (selectedTime === time) {
            classes += ' selected';
          }

          html += `<div class="${classes}" data-time="${time}">${time}</div>`;
        });

        timeGridEl.innerHTML = html;
        timeSlotsEl.style.display = 'block';

        // Add click handlers to time slots
        const timeSlotElements = timeGridEl.querySelectorAll('.time-slot:not(.unavailable)');
        timeSlotElements.forEach(slotEl => {
          slotEl.addEventListener('click', (e) => {
            const target = e.target;
            const time = target.getAttribute('data-time');
            if (time && selectedDate) {
              selectedTime = time;
              renderTimeSlots(selectedDate);
              
              // Update form time field
              const timeInput = document.getElementById('time');
              if (timeInput) {
                timeInput.value = time;
              }
            }
          });
        });
      }

      function renderCalendar(date) {
        if (!calendarEl) {
          console.error('Calendar element not found');
          return;
        }

        console.log('Rendering calendar for:', date);

        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();

        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                            'July', 'August', 'September', 'October', 'November', 'December'];

        let html = `
          <div class="calendar-header">
            <h3>${monthNames[month]} ${year}</h3>
            <div class="calendar-nav">
              <button type="button" id="prevMonth">&lt;</button>
              <button type="button" id="nextMonth">&gt;</button>
            </div>
          </div>
          <div class="calendar-grid">
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
            <div class="calendar-day-header">Sun</div>
        `;

        // Adjust starting day to Monday (0 = Sunday, so we convert to Monday = 0)
        const adjustedStartDay = startingDayOfWeek === 0 ? 6 : startingDayOfWeek - 1;

        // Empty cells before the first day
        for (let i = 0; i < adjustedStartDay; i++) {
          html += '<div class="calendar-day empty"></div>';
        }

        // Days of the month
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let day = 1; day <= daysInMonth; day++) {
          const currentDay = new Date(year, month, day);
          currentDay.setHours(0, 0, 0, 0);
          
          let classes = 'calendar-day';
          
          if (currentDay < today) {
            classes += ' unavailable';
          }
          if (currentDay.getTime() === today.getTime()) {
            classes += ' today';
          }
          if (selectedDate && currentDay.getTime() === selectedDate.getTime()) {
            classes += ' selected';
          }

          html += `<div class="${classes}" data-date="${year}-${month}-${day}">${day}</div>`;
        }

        html += '</div>';
        
        console.log('Setting calendar HTML');
        calendarEl.innerHTML = html;

        // Add event listeners
        const prevBtn = document.getElementById('prevMonth');
        const nextBtn = document.getElementById('nextMonth');
        
        if (prevBtn) prevBtn.addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar(currentDate);
        });
        
        if (nextBtn) nextBtn.addEventListener('click', () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar(currentDate);
        });

        // Day click handlers
        const dayElements = calendarEl.querySelectorAll('.calendar-day:not(.empty):not(.unavailable)');
        dayElements.forEach(dayEl => {
          dayEl.addEventListener('click', (e) => {
            const target = e.target;
            const dateStr = target.getAttribute('data-date');
            if (dateStr) {
              const [y, m, d] = dateStr.split('-').map(Number);
              selectedDate = new Date(y, m, d);
              selectedTime = null; // Reset selected time when date changes
              renderCalendar(currentDate);
              
              // Update form date field
              const dateInput = document.getElementById('date');
              if (dateInput) {
                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                                    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const formattedDate = `${monthNames[m]} ${d}, ${y}`;
                dateInput.value = formattedDate;
              }

              // Clear time field when date changes
              const timeInput = document.getElementById('time');
              if (timeInput) {
                timeInput.value = '';
                timeInput.placeholder = 'Select a time below';
              }

              // Show and render time slots
              renderTimeSlots(selectedDate);
            }
          });
        });
      }

      // Initialize calendar
      if (calendarEl) {
        renderCalendar(currentDate);
      }

      // Update page text based on language
      function updateLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('language', lang);
        
        // Update all elements with data-i18n attribute
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          const keys = key.split('.');
          let value = t[lang];
          for (const k of keys) {
            value = value[k];
          }
          if (value) {
            el.textContent = value;
          }
        });

        // Update placeholders
        document.querySelectorAll('[data-placeholder-i18n]').forEach(el => {
          const key = el.getAttribute('data-placeholder-i18n');
          const keys = key.split('.');
          let value = t[lang];
          for (const k of keys) {
            value = value[k];
          }
          if (value) {
            el.placeholder = value;
          }
        });

        // Update active language button
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
        });

        // Update HTML lang attribute
        document.documentElement.lang = lang;

        // Update page title
        document.title = t[lang].contact.pageTitle;

        // Update submit button text during submission
        const submitBtn = form?.querySelector('.submit-btn');
        if (submitBtn && submitBtn.textContent !== t[lang].contact.requestBooking && submitBtn.textContent !== t[lang].contact.sending) {
          submitBtn.textContent = t[lang].contact.requestBooking;
        }

        // Re-render calendar to preserve functionality after language change
        if (calendarEl) {
          renderCalendar(currentDate);
          // Re-render time slots if a date is selected
          if (selectedDate && timeSlotsEl) {
            renderTimeSlots(selectedDate);
          }
        }
      }

      // Language toggle buttons
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const lang = btn.getAttribute('data-lang');
          if (lang) {
            updateLanguage(lang);
          }
        });
      });

      // Initialize with saved language
      updateLanguage(currentLang);

      // Form submission
      if (form && formMessage) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const submitBtn = form.querySelector('.submit-btn');
          if (!submitBtn) return;
          
          // Set the reply-to field to the user's email
          const emailInput = document.getElementById('email');
          const replytoInput = document.getElementById('replyto');
          if (emailInput && replytoInput) {
            replytoInput.value = emailInput.value;
          }
          
          submitBtn.disabled = true;
          submitBtn.textContent = t[currentLang].contact.sending;
          formMessage.className = 'form-message';
          formMessage.style.display = 'none';

          try {
            // Submit to Web3Forms
            const response = await fetch('https://api.web3forms.com/submit', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
              },
              body: JSON.stringify(Object.fromEntries(new FormData(form)))
            });

            const result = await response.json();

            if (result.success) {
              formMessage.className = 'form-message success';
              formMessage.textContent = t[currentLang].contact.successMessage;
              form.reset();
              
              // Hide time slots and reset calendar
              if (timeSlotsEl) {
                timeSlotsEl.style.display = 'none';
              }
              selectedDate = null;
              selectedTime = null;
              renderCalendar(currentDate); // Re-render to clear selection
            } else {
              throw new Error(result.message || 'Submission failed');
            }
          } catch (error) {
            formMessage.className = 'form-message error';
            formMessage.textContent = t[currentLang].contact.errorMessage;
            console.error('Form submission error:', error);
          } finally {
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.textContent = t[currentLang].contact.requestBooking;
            }
          }
        });
      }
    </script>
    <script is:inline src="/scripts/letterfall.js"></script>
  </body>
</html>
